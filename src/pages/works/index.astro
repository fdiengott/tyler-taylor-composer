---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import { slugify } from '@/utils/common-utils';
import type { WorkType } from '@/content.config';
import { removeTemplates, sortWorksByDate } from '@/utils/data-utils';
import WorkCard from '@/components/WorkCard.astro';

const works = await getCollection('works');
const cleanWorks = removeTemplates(works).sort(sortWorksByDate);

const workCategories: string[] = Array.from(new Set(cleanWorks.map((work) => work.data.category)));

const worksByCategory = cleanWorks.reduce<Record<string, WorkType[]>>((acc, work) => {
    const category = work.data.category;
    if (!acc[category]) {
        acc[category] = [];
    }
    acc[category].push(work);
    return acc;
}, {});
---

<BaseLayout title="Works" description="My works">
    <h1>Works</h1>
    <ul class="category-list">
        {
            workCategories.map((category: string) => (
                <li>
                    <h2 class="category-title">{category}</h2>
                    <ul class="works-list">
                        {worksByCategory[category].map((work) => (
                            <WorkCard {...work.data} slug={`/works/${slugify(work.data.title)}`} />
                        ))}
                    </ul>
                </li>
            ))
        }
    </ul>
</BaseLayout>

<style>
    h1 {
        margin-block-end: 3rem;
    }

    .category-list {
        display: grid;
        gap: 6rem;
    }

    .works-list {
        display: grid;
        gap: 2rem;
    }

    .category-title {
        text-transform: capitalize;
    }
</style>
